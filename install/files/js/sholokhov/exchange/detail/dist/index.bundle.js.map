{"version":3,"file":"index.bundle.js","sources":["../src/config/target.js","../src/components/TargetSettings.ts"],"sourcesContent":["import {RenderType} from 'sholokhov.exchange.ui'\nexport default {\n    fields: [\n        {\n            view: RenderType.Input,\n            options: {\n                title: 'ID импорта:',\n                attributes: {\n                    name: 'target[hash]'\n                },\n            }\n        },\n        {\n            view: RenderType.Input,\n            options: {\n                title: 'Активность:',\n                attributes: {\n                    type: 'checkbox',\n                    name: 'target[active]'\n                },\n            }\n        },\n        {\n            view: RenderType.Input,\n            options: {\n                title: 'Деактивировать элементы, которые не пришли в импорте:',\n                attributes: {\n                    type: 'checkbox',\n                    name: 'target[deactivate]'\n                },\n            }\n        },\n    ]\n};","import Config from '../config/target.js';\nimport {Factory, RenderType} from 'sholokhov.exchange.ui';\n\n/**\n * @since 1.2.0\n * @version 1.2.0\n */\nexport class TargetSettings {\n    /**\n     * Контейнер UI\n     *\n     * @private\n     *\n     * @since 1.2.0\n     * @version 1.2.0\n     */\n    #node: Element|null = null;\n\n    /**\n     * Контейнер хранения пользовательских полей\n     *\n     * @private\n     *\n     * @since 1.2.0\n     * @version 1.2.0\n     */\n    #customFieldNode: Element|null = null;\n\n    /**\n     * Конфигурация отрисовки\n     *\n     * @private\n     *\n     * @since 1.2.0\n     * @version 1.2.0\n     */\n    #options: object;\n\n    /**\n     * @param {Element|string} node Контейнер в который будет производиться отрисовка\n     * @param {object} options Конфигурация отрисовки\n     */\n    constructor(node: string|Element, options: object = {}) {\n        if (typeof node === 'string') {\n            this.#node = document.querySelector(node);\n        } else if (node){\n            this.#node = node;\n        }\n\n        if (!this.#node) {\n            throw 'Invalid target settings node';\n        }\n\n        this.#options = options;\n    }\n\n    /**\n     * Отрисовка контейнера UI настроек\n     *\n     * @return void\n     *\n     * @since 1.2.0\n     * @version 1.2.0\n     */\n    view(): void {\n        this.#node.innerHTML = '';\n        this.#appendType();\n        this.#appendFields(this.#node, Config.fields);\n        this.#appendCustomFields();\n    }\n\n    /**\n     * Загрузка пользовательских полей\n     *\n     * @param target\n     * @private\n     *\n     * @since 1.2.0\n     * @version 1.2.0\n     */\n    #loadFields(target) {\n        BX.ajax.runAction(\n            'sholokhov:exchange.EntityController.getFields',\n            {\n                data: {\n                    code: target\n                }\n            }\n        )\n            .then(response => {\n                this.#customFieldNode.innerHTML = '';\n                if (Array.isArray(response.data)) {\n                    this.#appendFields(this.#customFieldNode, response.data);\n                }\n            })\n            .catch(response => console.error(response))\n    }\n\n    /**\n     * Добавление списка доступных обменов\n     *\n     * @private\n     * @return void\n     *\n     * @since 1.2.0\n     * @version 1.2.0\n     */\n    #appendType(): void {\n        let view;\n        let options = {\n            title: 'Тип обмена:',\n            attributes: {\n                name: 'target[type]',\n            },\n            events: {\n                onchange: (event) => this.#loadFields(event.target.value),\n            }\n        };\n\n        if (this.#options.id) {\n            view = RenderType.Input;\n            options.attributes.type = 'hidden';\n\n        } else {\n            view = RenderType.Select;\n            options.api = {\n                action: 'sholokhov:exchange.EntityController.getByType',\n                data: {\n                    code: 'target'\n                },\n                callback: function(response) {\n                    if (!Array.isArray(response.data)) {\n                        return [];\n                    }\n\n                    response.data = response.data.map(field => ({\n                        value: field.CODE,\n                        name: field.NAME,\n                    }));\n\n                    return response;\n                }\n            };\n        }\n\n        this.#node.append(Factory.create(view, options));\n    }\n\n    /**\n     * Добавление контейнера с пользовательскими полями\n     *\n     * @private\n     *\n     * @since 1.2.0\n     * @version 1.2.0\n     */\n    #appendCustomFields(): void {\n        this.#customFieldNode = document.createElement('div');\n        this.#node.append(this.#customFieldNode);\n    }\n\n    /**\n     * Отрисовка полей в контейнер\n     *\n     * @param node\n     * @param iterator\n     * @private\n     *\n     * @since 1.2.0\n     * @version 1.2.0\n     */\n    #appendFields(node: Element, iterator: Array<object>): void {\n        iterator.forEach(field => {\n            const element = Factory.create(field.view, field.options);\n            if (element) {\n                node.append(element);\n            }\n        })\n    }\n}"],"names":["fields","view","RenderType","Input","options","title","attributes","name","type","TargetSettings","node","document","querySelector","innerHTML","Config","target","BX","ajax","runAction","data","code","then","response","Array","isArray","console","error","events","onchange","event","value","id","Select","api","action","callback","map","field","CODE","NAME","append","Factory","create","createElement","iterator","forEach","element"],"mappings":"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"}